

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Introduction &mdash; Numeric course 0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../../../../" src="../../../../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../../../../_static/jquery.js"></script>
        <script src="../../../../../../../../_static/underscore.js"></script>
        <script src="../../../../../../../../_static/doctools.js"></script>
        <script src="../../../../../../../../_static/language_data.js"></script>
        <script src="../../../../../../../../_static/togglebutton.js"></script>
        <script >var togglebuttonSelector = '.toggle, .tag_hide_input div.cell_input, .tag_hide_output div.cell_output, .tag_hide_cell.cell';</script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../../../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../../../_static/togglebutton.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../../../../_static/mystnb.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../../../../../index.html" class="icon icon-home"> Numeric course
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../../course_bootstrap.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../../ugradsyllabus20.html">Undergrad Syllabus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../../gradsyllabus20.html">Grad Syllabus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../../schedule20.html">Detailed Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../../texts.html">Optional texts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../../notebook_toc.html">Course/lab descriptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../../week_notes.html">Weekly notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../../assignments.html">Weekly assignments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../../quizzes.html">Quizzes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../../solutions.html">Solutions</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../../../index.html">Numeric course</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../../../../index.html">Docs</a> &raquo;</li>
        
      <li>Introduction</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../../../../../../_sources/jupyter_execute/jupyter_execute/jupyter_execute/jupyter_execute/jupyter_execute/jupyter_execute/doc_notebooks/lab9/fftnotebook.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Table of Contents<span class="tocSkip"></span></h1>
<div class="toc" style="margin-top: 1em;"><ul class="toc-item"><li><span><a href="#Introduction" data-toc-modified-id="Introduction-1"><span class="toc-item-num">1&nbsp;&nbsp;</span>Introduction</a></span><ul class="toc-item"><li><span><a href="#A-simple-transform" data-toc-modified-id="A-simple-transform-1.1"><span class="toc-item-num">1.1&nbsp;&nbsp;</span>A simple transform</a></span></li><li><span><a href="#Power-spectrum-of-turbulent-vertical-velocity" data-toc-modified-id="Power-spectrum-of-turbulent-vertical-velocity-1.2"><span class="toc-item-num">1.2&nbsp;&nbsp;</span>Power spectrum of turbulent vertical velocity</a></span></li><li><span><a href="#power-spectrum-layout" data-toc-modified-id="power-spectrum-layout-1.3"><span class="toc-item-num">1.3&nbsp;&nbsp;</span>power spectrum layout</a></span><ul class="toc-item"><li><span><a href="#Confirm-that-the-fft-at-negative-f-is-the-complex-conjugate-of-the-fft-at-positive-f" data-toc-modified-id="Confirm-that-the-fft-at-negative-f-is-the-complex-conjugate-of-the-fft-at-positive-f-1.3.1"><span class="toc-item-num">1.3.1&nbsp;&nbsp;</span>Confirm that the fft at negative f is the complex conjugate of the fft at positive f</a></span></li></ul></li><li><span><a href="#Windowing" data-toc-modified-id="Windowing-1.4"><span class="toc-item-num">1.4&nbsp;&nbsp;</span>Windowing</a></span></li><li><span><a href="#Compare-power-spectra-for-wvel,-theta,-sensible-heat-flux" data-toc-modified-id="Compare-power-spectra-for-wvel,-theta,-sensible-heat-flux-1.5"><span class="toc-item-num">1.5&nbsp;&nbsp;</span>Compare power spectra for wvel, theta, sensible heat flux</a></span><ul class="toc-item"><li><span><a href="#start-with-wvel" data-toc-modified-id="start-with-wvel-1.5.1"><span class="toc-item-num">1.5.1&nbsp;&nbsp;</span>start with wvel</a></span></li></ul></li><li><span><a href="#Filtering" data-toc-modified-id="Filtering-1.6"><span class="toc-item-num">1.6&nbsp;&nbsp;</span>Filtering</a></span></li></ul></li></ul></div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;ggplot&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<div class="section" id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h1>
<p>This lab introduces the use of the fast Fourier transform for estimation
of the power spectral density and for simple filtering.  If you need a refresher or
are learning about fourier transforms for the first time,  we recommend reading
<a class="reference external" href="http://clouds.eos.ubc.ca/~phil/docs/atsc500/pdf_files/newman_chapter7.pdf">Newman Chapter 7</a>.  For a description of the Fast Fourier transform,
see <a class="reference external" href="http://clouds.eos.ubc.ca/~phil/docs/atsc500/pdf_files/stull_section8_4.pdf">Stull Section 8.4</a> and <a class="reference external" href="https://jakevdp.github.io/blog/2013/08/28/understanding-the-fft/">Jake VanderPlas’s blog entry</a>.  Another good resources is
<a class="reference external" href="http://clouds.eos.ubc.ca/~phil/docs/atsc500/pdf_files/numerical_recipes_fft.pdf">Numerical Recipes Chapter 12</a>
(user: green, password: house)</p>
<div class="section" id="a-simple-transform">
<h2>A simple transform<a class="headerlink" href="#a-simple-transform" title="Permalink to this headline">¶</a></h2>
<p>To get started assume that there is a pure tone – a cosine wave oscillating at a frequency of 1 Hz.  Next assume that we sample that 1 Hz wave at a sampling rate of 5 Hz i.e. 5 times a second</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="c1">#</span>
<span class="c1"># create a cosine wave that oscilates 20 times in 20 seconds</span>
<span class="c1"># sampled at  Hz, so there are 20*5 = 100 measurements in 20 seconds</span>
<span class="c1">#</span>
<span class="n">deltaT</span><span class="o">=</span><span class="mf">0.2</span>
<span class="n">ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="n">deltaT</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1">#20 cycles in 20 seconds, each cycle goes through 2*pi radians</span>
<span class="c1">#</span>
<span class="n">onehz</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">ticks</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ticks</span><span class="p">,</span><span class="n">onehz</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;one hz wave sampled at 5 Hz&#39;</span><span class="p">)</span>
<span class="n">out</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time (seconds)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../../../../../_images/fftnotebook_3_0.png" src="../../../../../../../../_images/fftnotebook_3_0.png" />
</div>
</div>
<p>Repeat, but for a 2 Hz wave</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">deltaT</span><span class="o">=</span><span class="mf">0.2</span>
<span class="n">ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="n">deltaT</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1">#40 cycles in 20 seconds, each cycle goes through 2*pi radians</span>
<span class="c1">#</span>
<span class="n">twohz</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">ticks</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ticks</span><span class="p">,</span><span class="n">twohz</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;two hz wave sampled at 5 Hz&#39;</span><span class="p">)</span>
<span class="n">out</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time (seconds)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../../../../../_images/fftnotebook_5_0.png" src="../../../../../../../../_images/fftnotebook_5_0.png" />
</div>
</div>
<p>Note the problem at 2 Hz,  the 5 Hz sampling frequency is too coarse to hit the top of every other
peak in the wave</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#now take the fft, we have 100 bins, so we alias at 50 bins, which is the nyquist frequency of 5 Hz/2. = 2.5 Hz</span>
<span class="c1"># so the fft frequency resolution is 20 bins/Hz, or 1 bin = 0.05 Hz</span>
<span class="n">thefft</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">onehz</span><span class="p">)</span>
<span class="n">real_coeffs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">thefft</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span><span class="n">theAx</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">real_coeffs</span><span class="p">)</span>
<span class="n">out</span><span class="o">=</span><span class="n">theAx</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;real fft of onehz&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../../../../../_images/fftnotebook_7_0.png" src="../../../../../../../../_images/fftnotebook_7_0.png" />
</div>
</div>
<p>The layout of the fft return value is describe in <a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/tutorial/fftpack.html#id9">the scipy user manual</a>.   For reference, here is the Fourier transform calculated by numpy.fft:</p>
<p><div class="math notranslate nohighlight">
\[y[k] = \sum_{n=0}^{N-1} x[n]\exp \left (- i 2 \pi k n /N \right )\]</div>
</p>
<p>which is the discrete version of the continuous transform (Numerical Recipes 12.0.4):</p>
<p><div class="math notranslate nohighlight">
\[y(k) = \int_{-\infty}^{\infty} x(t) \exp \left ( -i k t \right ) dt\]</div>
</p>
<p>(Note the different minus sign convention in the exponent compared to Numerical Recipes p. 490.  It doesn’t matter what you choose, as long
as you’re consistent).</p>
<p>From the Scipy manual:</p>
<blockquote>
<div><p>Inserting k=0 we see that np.sum(x)  corresponds to y[0]. This term will be non-zero if we haven’t removed any large scale trend in the data. For N even, the elements y[1]…y[N/2−1] contain the positive-frequency terms, and the elements y[N/2]…y[N−1] contain the negative-frequency terms, in order of decreasingly negative frequency. For N odd, the elements y[1]…y[(N−1)/2] contain the positive- frequency terms, and the elements y[(N+1)/2]…y[N−1] contain the negative- frequency terms, in order of decreasingly negative frequency.
In case the sequence x is real-valued, the values of y[n] for positive frequencies is the conjugate of the values y[n] for negative frequencies (because the spectrum is symmetric). Typically, only the FFT corresponding to positive frequencies is plotted.</p>
</div></blockquote>
<p>So the first peak at index 20 is (20 bins) x (0.05 Hz/bin) = 1 Hz, as expected.  The nyquist frequency of 2.5 Hz is at an index of N/2 = 50 and the negative frequency peak is 20 bins to the left of the end bin.</p>
<p>The inverse transform is:</p>
<p><div class="math notranslate nohighlight">
\[x[n] = \frac{1}{N} \sum_{k=0}^{N-1} y]k]\exp \left ( i 2 \pi k n /N \right )\]</div>
</p>
<p>What about the imaginary part?  All imaginary coefficients are zero (neglecting roundoff errors)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">imag_coeffs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">thefft</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span><span class="n">theAx</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">imag_coeffs</span><span class="p">)</span>
<span class="n">out</span><span class="o">=</span><span class="n">theAx</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;imag fft of onehz&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../../../../../_images/fftnotebook_10_0.png" src="../../../../../../../../_images/fftnotebook_10_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#now evaluate the power spectrum using Stull&#39;s 8.6.1a on p. 312</span>

<span class="n">Power</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">thefft</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">thefft</span><span class="p">))</span>
<span class="n">totsize</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">thefft</span><span class="p">)</span>
<span class="n">halfpoint</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">totsize</span><span class="o">/</span><span class="mf">2.</span><span class="p">))</span>
<span class="n">firsthalf</span><span class="o">=</span><span class="n">Power</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">halfpoint</span><span class="p">]</span> 


<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">freq</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">5.</span><span class="p">,</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">halfpoint</span><span class="p">],</span><span class="n">firsthalf</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;power spectrum&#39;</span><span class="p">)</span>
<span class="n">out</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;frequency (Hz)&#39;</span><span class="p">)</span>
<span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>100
</pre></div>
</div>
<img alt="../../../../../../../../_images/fftnotebook_11_1.png" src="../../../../../../../../_images/fftnotebook_11_1.png" />
</div>
</div>
<p>Check Stull 8.6.1b (or Numerical Recipes 12.0.13) which says that squared power spectrum = variance</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">simple cosine: velocity variance </span><span class="si">%10.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">onehz</span><span class="o">*</span><span class="n">onehz</span><span class="p">)</span><span class="o">/</span><span class="n">totsize</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;simple cosine: Power spectrum sum </span><span class="si">%10.3f</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Power</span><span class="p">)</span><span class="o">/</span><span class="n">totsize</span><span class="o">**</span><span class="mf">2.</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>
simple cosine: velocity variance      0.500
simple cosine: Power spectrum sum      0.500

</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="power-spectrum-of-turbulent-vertical-velocity">
<h2>Power spectrum of turbulent vertical velocity<a class="headerlink" href="#power-spectrum-of-turbulent-vertical-velocity" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#load data sampled at 20.8333 Hz</span>

<span class="n">td</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;miami_tower.npz&#39;</span><span class="p">)</span> <span class="c1">#load temp, uvel, vvel, wvel, minutes</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;keys: &#39;</span><span class="p">,</span><span class="n">td</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">td</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span>---------------------------------------------------------------------------
NameError                                 Traceback (most recent call last)
&lt;ipython-input-8-5f80d41902e4&gt; in &lt;module&gt;
      1 #load data sampled at 20.8333 Hz
      2 
----&gt; 3 td=numpy.load(&#39;miami_tower.npz&#39;) #load temp, uvel, vvel, wvel, minutes
      4 print(&#39;keys: &#39;,td.keys())
      5 print(td[&#39;description&#39;])

NameError: name &#39;numpy&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sampleRate</span><span class="o">=</span><span class="mf">20.833</span>
<span class="n">nyquistfreq</span><span class="o">=</span><span class="n">sampleRate</span><span class="o">/</span><span class="mf">2.</span>


<span class="n">totsize</span><span class="o">=</span><span class="mi">36000</span>
<span class="n">wvel</span><span class="o">=</span><span class="n">td</span><span class="p">[</span><span class="s1">&#39;wvel&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">totsize</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">temp</span><span class="o">=</span><span class="n">td</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">totsize</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">wvel</span> <span class="o">=</span> <span class="n">wvel</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wvel</span><span class="p">)</span>
<span class="n">temp</span><span class="o">=</span> <span class="n">temp</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
<span class="n">flux</span><span class="o">=</span><span class="n">wvel</span><span class="o">*</span><span class="n">temp</span>


<span class="n">halfpoint</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">totsize</span><span class="o">/</span><span class="mf">2.</span><span class="p">))</span>
<span class="n">frequencies</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">halfpoint</span><span class="p">)</span>
<span class="n">frequencies</span><span class="o">=</span><span class="n">frequencies</span><span class="o">/</span><span class="n">halfpoint</span>
<span class="n">frequencies</span><span class="o">=</span><span class="n">frequencies</span><span class="o">*</span><span class="n">nyquistfreq</span>

<span class="c1"># raw spectrum -- no windowing or averaging</span>
<span class="c1">#First confirm Parseval&#39;s theorem</span>
<span class="c1"># (Numerical Recipes 12.1.10, p. 498)</span>

<span class="n">thefft</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">wvel</span><span class="p">)</span>
<span class="n">Power</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">thefft</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">thefft</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;check Wiener-Khichine theorem for wvel&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">raw fft sum, full time series: </span><span class="si">%10.4f</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Power</span><span class="p">)</span><span class="o">/</span><span class="n">totsize</span><span class="o">**</span><span class="mf">2.</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;velocity variance: </span><span class="si">%10.4f</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">wvel</span><span class="o">*</span><span class="n">wvel</span><span class="p">)</span><span class="o">/</span><span class="n">totsize</span><span class="p">))</span>


<span class="n">fig</span><span class="p">,</span><span class="n">theAx</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">frequencies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
<span class="n">Power</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
<span class="n">Power_half</span><span class="o">=</span><span class="n">Power</span><span class="p">[:</span><span class="n">halfpoint</span><span class="p">:]</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">frequencies</span><span class="p">,</span><span class="n">Power_half</span><span class="p">)</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;raw wvel spectrum with $f^{-5/3}$&#39;</span><span class="p">)</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;frequency (HZ)&#39;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Power (m^2/s^2)&#39;</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># pick one point the line should pass through (by eye)</span>
<span class="c1"># note that y intercept will be at log10(freq)=0</span>
<span class="c1"># or freq=1 Hz</span>
<span class="c1">#</span>
<span class="n">leftspec</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Power</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mf">1.e-3</span><span class="p">)</span>
<span class="n">logy</span><span class="o">=</span><span class="n">leftspec</span> <span class="o">-</span> <span class="mf">5.</span><span class="o">/</span><span class="mf">3.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span>
<span class="n">yvals</span><span class="o">=</span><span class="mf">10.</span><span class="o">**</span><span class="n">logy</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">frequencies</span><span class="p">,</span><span class="n">yvals</span><span class="p">,</span><span class="s1">&#39;r-&#39;</span><span class="p">)</span>
<span class="n">thePoint</span><span class="o">=</span><span class="n">theAx</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span><span class="n">Power</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mf">1.e-3</span><span class="p">,</span><span class="s1">&#39;g+&#39;</span><span class="p">)</span>
<span class="n">thePoint</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_markersize</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
<span class="n">thePoint</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_marker</span><span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">)</span>
<span class="n">thePoint</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_markerfacecolor</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span>---------------------------------------------------------------------------
NameError                                 Traceback (most recent call last)
&lt;ipython-input-9-063bfe0d8a7d&gt; in &lt;module&gt;
      4 
      5 totsize=36000
----&gt; 6 wvel=td[&#39;wvel&#39;][0:totsize].flatten()
      7 temp=td[&#39;temp&#39;][0:totsize].flatten()
      8 wvel = wvel - np.mean(wvel)

NameError: name &#39;td&#39; is not defined
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="power-spectrum-layout">
<h2>power spectrum layout<a class="headerlink" href="#power-spectrum-layout" title="Permalink to this headline">¶</a></h2>
<p>Here is what the entire power spectrum looks like, showing positive and negative frequencies</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">theAx</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">out</span><span class="o">=</span><span class="n">theAx</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">Power</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../../../../../_images/fftnotebook_19_0.png" src="../../../../../../../../_images/fftnotebook_19_0.png" />
</div>
</div>
<p>and here is what fftshift does:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">shift_power</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">Power</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span><span class="n">theAx</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">out</span><span class="o">=</span><span class="n">theAx</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">shift_power</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../../../../../_images/fftnotebook_21_0.png" src="../../../../../../../../_images/fftnotebook_21_0.png" />
</div>
</div>
<div class="section" id="confirm-that-the-fft-at-negative-f-is-the-complex-conjugate-of-the-fft-at-positive-f">
<h3>Confirm that the fft at negative f is the complex conjugate of the fft at positive f<a class="headerlink" href="#confirm-that-the-fft-at-negative-f-is-the-complex-conjugate-of-the-fft-at-positive-f" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_fft</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">wvel</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span><span class="n">theAx</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">theAx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">test_fft</span><span class="p">))</span>
<span class="n">theAx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">test_fft</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">test_fft</span><span class="p">[</span><span class="mi">100</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">test_fft</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span>---------------------------------------------------------------------------
NameError                                 Traceback (most recent call last)
&lt;ipython-input-12-9609502a6f5b&gt; in &lt;module&gt;
----&gt; 1 test_fft=np.fft.fft(wvel)
      2 fig,theAx=plt.subplots(2,1,figsize=(8,10))
      3 theAx[0].semilogy(np.real(test_fft))
      4 theAx[1].semilogy(np.imag(test_fft))
      5 print(test_fft[100])

NameError: name &#39;wvel&#39; is not defined
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="windowing">
<h2>Windowing<a class="headerlink" href="#windowing" title="Permalink to this headline">¶</a></h2>
<p>The FFT above is noisy, and there are several ways to smooth it.  Numerical Recipes, p. 550 has a good discussion of “windowing” which helps remove the spurious power caused by the fact that the timeseries has a sudden stop and start.
Below we split the timeseries into 25 segements of 1440 points each, fft each segment then average the 25.  We convolve each segment with a Bartlett window.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n\n</span><span class="s1">Try a windowed spectrum (Bartlett window)</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="c1">## windowing -- see p. Numerical recipes 550 for notation</span>

<span class="k">def</span> <span class="nf">calc_window</span><span class="p">(</span><span class="n">numvals</span><span class="o">=</span><span class="mi">1440</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Calculate a Bartlett window following</span>
<span class="sd">      Numerical Recipes 13.4.13</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">halfpoint</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">numvals</span><span class="o">/</span><span class="mf">2.</span><span class="p">))</span>
    <span class="n">facm</span><span class="o">=</span><span class="n">halfpoint</span>
    <span class="n">facp</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">facm</span>

    <span class="n">window</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="n">numvals</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">numvals</span><span class="p">):</span>
        <span class="n">window</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="p">((</span><span class="n">j</span> <span class="o">-</span> <span class="n">facm</span><span class="p">)</span><span class="o">*</span><span class="n">facp</span><span class="p">)</span><span class="o">**</span><span class="mf">2.</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">window</span>

<span class="c1">#</span>
<span class="c1">#  we need to normalize by the squared weights</span>
<span class="c1">#  (see the fortran code on Numerical recipes p. 550)</span>
<span class="c1">#</span>
<span class="n">numvals</span><span class="o">=</span><span class="mi">1440</span>
<span class="n">window</span><span class="o">=</span><span class="n">calc_window</span><span class="p">(</span><span class="n">numvals</span><span class="o">=</span><span class="n">numvals</span><span class="p">)</span>
<span class="n">sumw</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">window</span><span class="o">**</span><span class="mf">2.</span><span class="p">)</span><span class="o">/</span><span class="n">numvals</span>
<span class="n">fig</span><span class="p">,</span><span class="n">theAx</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Bartlett window&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sumw: </span><span class="si">%10.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">sumw</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>


Try a windowed spectrum (Bartlett window)

sumw:      0.533
</pre></div>
</div>
<img alt="../../../../../../../../_images/fftnotebook_25_1.png" src="../../../../../../../../_images/fftnotebook_25_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">do_fft</span><span class="p">(</span><span class="n">the_series</span><span class="p">,</span><span class="n">window</span><span class="p">,</span><span class="n">ensemble</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;title&#39;</span><span class="p">):</span>
    <span class="n">numvals</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
    <span class="n">sumw</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">window</span><span class="o">**</span><span class="mf">2.</span><span class="p">)</span><span class="o">/</span><span class="n">numvals</span>
    <span class="n">subset</span><span class="o">=</span><span class="n">the_series</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">subset</span><span class="o">=</span><span class="n">subset</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">window</span><span class="p">)</span><span class="o">*</span><span class="n">ensemble</span><span class="p">]</span>
    <span class="n">subset</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">subset</span><span class="p">,(</span><span class="n">ensemble</span><span class="p">,</span><span class="n">numvals</span><span class="p">))</span>
    <span class="n">winspec</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">numvals</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">therow</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ensemble</span><span class="p">):</span>
        <span class="n">thedat</span><span class="o">=</span><span class="n">subset</span><span class="p">[</span><span class="n">therow</span><span class="p">,:]</span>
        <span class="n">thefft</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">thedat</span><span class="o">*</span><span class="n">window</span><span class="p">)</span>
        <span class="n">Power</span><span class="o">=</span><span class="n">thefft</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">thefft</span><span class="p">)</span>
        <span class="c1">#print(&#39;\nensemble member: %d&#39; % therow)</span>
        <span class="c1">#print(&#39;\nwindowed fft sum (m^2/s^2): %10.4f\n&#39; % (np.sum(Power)/(sumw*numvals**2.),))</span>
        <span class="c1">#print(&#39;velocity variance (m^2/s^2): %10.4f\n\n&#39; % (np.sum(thedat*thedat)/numvals,))</span>
        <span class="n">winspec</span><span class="o">=</span><span class="n">winspec</span> <span class="o">+</span> <span class="n">Power</span>

    <span class="n">winspec</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">winspec</span><span class="o">/</span><span class="p">(</span><span class="n">numvals</span><span class="o">**</span><span class="mf">2.</span><span class="o">*</span><span class="n">ensemble</span><span class="o">*</span><span class="n">sumw</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">winspec</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
</div>
<div class="section" id="compare-power-spectra-for-wvel-theta-sensible-heat-flux">
<h2>Compare power spectra for wvel, theta, sensible heat flux<a class="headerlink" href="#compare-power-spectra-for-wvel-theta-sensible-heat-flux" title="Permalink to this headline">¶</a></h2>
<div class="section" id="start-with-wvel">
<h3>start with wvel<a class="headerlink" href="#start-with-wvel" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">winspec</span><span class="o">=</span><span class="n">do_fft</span><span class="p">(</span><span class="n">wvel</span><span class="p">,</span><span class="n">window</span><span class="p">)</span>
<span class="n">sampleRate</span><span class="o">=</span><span class="mf">20.833</span>
<span class="n">nyquistfreq</span><span class="o">=</span><span class="n">sampleRate</span><span class="o">/</span><span class="mf">2.</span>
<span class="n">halfpoint</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">winspec</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
<span class="n">averaged_freq</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="n">halfpoint</span><span class="p">)</span><span class="o">*</span><span class="n">nyquistfreq</span>   
<span class="n">winspec</span><span class="o">=</span><span class="n">winspec</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">halfpoint</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span>---------------------------------------------------------------------------
NameError                                 Traceback (most recent call last)
&lt;ipython-input-15-c9fa25d2f2bd&gt; in &lt;module&gt;
----&gt; 1 winspec=do_fft(wvel,window)
      2 sampleRate=20.833
      3 nyquistfreq=sampleRate/2.
      4 halfpoint=int(len(winspec)/2.)
      5 averaged_freq=np.linspace(0,1.,halfpoint)*nyquistfreq

NameError: name &#39;wvel&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">do_plot</span><span class="p">(</span><span class="n">the_freq</span><span class="p">,</span><span class="n">the_spec</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">the_freq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
    <span class="n">the_spec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
    <span class="n">fig</span><span class="p">,</span><span class="n">theAx</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
    <span class="n">theAx</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">the_freq</span><span class="p">,</span><span class="n">the_spec</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;fft power&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
        <span class="n">theAx</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">leftspec</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">the_spec</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">halfpoint</span><span class="o">/</span><span class="mf">10.</span><span class="p">))])</span>
    <span class="n">logy</span><span class="o">=</span><span class="n">leftspec</span> <span class="o">-</span> <span class="mf">5.</span><span class="o">/</span><span class="mf">3.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">the_freq</span><span class="p">)</span>
    <span class="n">yvals</span><span class="o">=</span><span class="mf">10.</span><span class="o">**</span><span class="n">logy</span>
    <span class="n">theAx</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">the_freq</span><span class="p">,</span><span class="n">yvals</span><span class="p">,</span><span class="s1">&#39;g-&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;$f^{-5/3}$&#39;</span><span class="p">)</span>
    <span class="n">theAx</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;frequency (Hz)&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ylabel</span><span class="p">:</span>
        <span class="n">out</span><span class="o">=</span><span class="n">theAx</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="n">out</span><span class="o">=</span><span class="n">theAx</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">theAx</span>

<span class="n">labels</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;wvel power spectrum&#39;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;$(m^2\,s^{-2}\,Hz^{-1})$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">=</span><span class="n">do_plot</span><span class="p">(</span><span class="n">averaged_freq</span><span class="p">,</span><span class="n">winspec</span><span class="p">,</span><span class="o">**</span><span class="n">labels</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span>---------------------------------------------------------------------------
NameError                                 Traceback (most recent call last)
&lt;ipython-input-16-89de65363de2&gt; in &lt;module&gt;
     17 
     18 labels=dict(title=&#39;wvel power spectrum&#39;,ylabel=&#39;$(m^2\,s^{-2}\,Hz^{-1})$&#39;)
---&gt; 19 ax=do_plot(averaged_freq,winspec,**labels)

NameError: name &#39;averaged_freq&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">winspec</span><span class="o">=</span><span class="n">do_fft</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="n">window</span><span class="p">)</span>
<span class="n">winspec</span><span class="o">=</span><span class="n">winspec</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">halfpoint</span><span class="p">]</span>
<span class="n">labels</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Temperature power spectrum&#39;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;$K^</span><span class="si">{2}</span><span class="s1">\,Hz^{-1})$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">=</span><span class="n">do_plot</span><span class="p">(</span><span class="n">averaged_freq</span><span class="p">,</span><span class="n">winspec</span><span class="p">,</span><span class="o">**</span><span class="n">labels</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span>---------------------------------------------------------------------------
NameError                                 Traceback (most recent call last)
&lt;ipython-input-17-29f96944eaab&gt; in &lt;module&gt;
----&gt; 1 winspec=do_fft(temp,window)
      2 winspec=winspec[0:halfpoint]
      3 labels=dict(title=&#39;Temperature power spectrum&#39;,ylabel=&#39;$K^{2}\,Hz^{-1})$&#39;)
      4 ax=do_plot(averaged_freq,winspec,**labels)

NameError: name &#39;temp&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">winspec</span><span class="o">=</span><span class="n">do_fft</span><span class="p">(</span><span class="n">flux</span><span class="p">,</span><span class="n">window</span><span class="p">)</span>
<span class="n">winspec</span><span class="o">=</span><span class="n">winspec</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">halfpoint</span><span class="p">]</span>
<span class="n">labels</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Heat flux power spectrum&#39;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;$K m s^{-1}\,Hz^{-1})$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">=</span><span class="n">do_plot</span><span class="p">(</span><span class="n">averaged_freq</span><span class="p">,</span><span class="n">winspec</span><span class="p">,</span><span class="o">**</span><span class="n">labels</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span>---------------------------------------------------------------------------
NameError                                 Traceback (most recent call last)
&lt;ipython-input-18-4425da1610b2&gt; in &lt;module&gt;
----&gt; 1 winspec=do_fft(flux,window)
      2 winspec=winspec[0:halfpoint]
      3 labels=dict(title=&#39;Heat flux power spectrum&#39;,ylabel=&#39;$K m s^{-1}\,Hz^{-1})$&#39;)
      4 ax=do_plot(averaged_freq,winspec,**labels)

NameError: name &#39;flux&#39; is not defined
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="filtering">
<h2>Filtering<a class="headerlink" href="#filtering" title="Permalink to this headline">¶</a></h2>
<p>We can also filter our timeseries by removing frequencies we aren’t interested in. Numerical Recipes discusses the approach on page 551.  For example, suppose we want to filter all frequencies higher than 0.5 Hz from the vertical velocity data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wvel</span><span class="o">=</span> <span class="n">wvel</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wvel</span><span class="p">)</span>
<span class="n">thefft</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">wvel</span><span class="p">)</span>
<span class="n">totsize</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">thefft</span><span class="p">)</span>
<span class="n">samprate</span><span class="o">=</span><span class="mf">20.8333</span> <span class="c1">#Hz</span>
<span class="n">the_time</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">totsize</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="mf">20.8333</span><span class="p">)</span>
<span class="n">freq_bin_width</span><span class="o">=</span><span class="n">samprate</span><span class="o">/</span><span class="p">(</span><span class="n">totsize</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
<span class="n">half_hz_index</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="mf">0.5</span><span class="o">/</span><span class="n">freq_bin_width</span><span class="p">))</span>
<span class="n">filter_func</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">thefft</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">filter_func</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">half_hz_index</span><span class="p">]</span><span class="o">=</span><span class="mf">1.</span>
<span class="n">filter_func</span><span class="p">[</span><span class="o">-</span><span class="n">half_hz_index</span><span class="p">:]</span><span class="o">=</span><span class="mf">1.</span>
<span class="n">filtered_wvel</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">filter_func</span><span class="o">*</span><span class="n">thefft</span><span class="p">))</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">numpoints</span><span class="o">=</span><span class="mi">500</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">the_time</span><span class="p">[:</span><span class="n">numpoints</span><span class="p">],</span><span class="n">filtered_wvel</span><span class="p">[:</span><span class="n">numpoints</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;filtered&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">the_time</span><span class="p">[:</span><span class="n">numpoints</span><span class="p">],</span><span class="n">wvel</span><span class="p">[:</span><span class="n">numpoints</span><span class="p">],</span><span class="s1">&#39;g+&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;time (seconds)&#39;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;wvel (m/s)&#39;</span><span class="p">)</span>
<span class="n">out</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span>---------------------------------------------------------------------------
NameError                                 Traceback (most recent call last)
&lt;ipython-input-19-666e2342b1f0&gt; in &lt;module&gt;
----&gt; 1 wvel= wvel - np.mean(wvel)
      2 thefft=np.fft.fft(wvel)
      3 totsize=len(thefft)
      4 samprate=20.8333 #Hz
      5 the_time=np.arange(0,totsize,1/20.8333)

NameError: name &#39;wvel&#39; is not defined
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Numeric project

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>